<!DOCTYPE html>
<html lang='es'>
<head>
	<meta charset="utf-8">
	<title>mediateca guifibaix</title>
	<meta content="">
<!--	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>-->
<!--	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>-->
<!--	<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />-->
	<script src="jquery-2.1.0.min.js"></script>
	<script src="jquery-ui-1.10.4.min.js"></script>
	<link rel="stylesheet" href="jquery-ui-1.10.4.css" />
	<style>
		@keyframes fadein {
			from {opacity: 0;}
			to {opacity: 1;}
		}
		@-webkit-keyframes fadein {
			from {-webkit-opacity: 0;}
			to {-webkit-opacity: 1;}
		}
		@keyframes fadeout {
			from {opacity: 1;}
			to {opacity: 0;}
		}
		@-webkit-keyframes fadeout {
			from {-webkit-opacity: 1;}
			to {-webkit-opacity: 0;}
		}
		body {
			position: fixed;
			width: 100%;
			height: 100%;
			top: 0;
			bottom: 0;
			left: 0;
			margin: 0;
			border: 2pt black solid;
			color: #eeeeee;
			background-color: #222222;
		}
		header {
			/*border: 1pt solid red;*/
			margin: 0;
			padding-left: 12ex;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			z-index: 10;
			background-color: #222222;
			background-image: url('logo-guifibaix-mediateca.svg');
			background-position: left;
			background-repeat: no-repeat;
			background-size: 15ex auto;
			min-height: 9ex;
			vertical-align: middle;
		}
		header input {
			margin-top: 9px;
		}
		footer {
			position: fixed;
			bottom: 0;
			left: 0;
			right: 0;
			width: 100%;
			text-align: right;
			background-color: #222222;
			color: #aa3;
		}
		.search {
			/*border: 1pt red solid;*/
			width:100%;
			text-align: center;
		}
		.search input
		{
			width: 50%;
		}
		.search input,
		.search select
		{
			padding: 1ex;
			color: #fff;
			background: #400000;
			border-radius: 5pt;
			border: #000 solid 2pt;
		}
		.itembrowser {
			padding-top: 9ex;
			text-align: center;
			margin-right: auto;
			margin-left: auto;
			width: 90%;
		}
		.itembrowser .mediaitem {
			position: relative;
			display: inline-block;
			width: 200px;
			height: 300px;
			bottom: 0px;
			border: 3pt solid black;
			margin: 10px;
			box-shadow: 2pt 3pt 6pt #500;
		}
		.itembrowser .mediaitem:hover {
			box-shadow: 1pt 2pt 7pt #a7f;
		}
		.search :focus,
		.itembrowser :focus {
			box-shadow: 0pt 0pt 9pt #a7f;
		}
		.itembrowser .mediaitem {
		}
		.itembrowser .mediaitem img {
			display: inline;
			width: 100%;
			height: 300px;
			object-fit: fill;
		}
		.itembrowser .mediaitem .mediadescription {
			display: none;
		}
		.itembrowser .mediaitem:hover .mediadescription {
			display: block;
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
			padding: 8px;
			opacity: 0.8;
			background-color: #333;
			font-weight: bold;
			color: #ff3;
		}

		.extendedinfo {
			display: block;
			position: fixed;
			right: 0;
			left: 0;
			top: 100%;
			bottom: -100%;
			height: 70%;
			width: 80%;
			z-index: 15;
			padding: 3%;
			margin: 5%;
			box-shadow: 0px 0px 8px white;
			border: 5px solid white;
			background: #333;
			opacity: 0.2;
			transition: left 1s, top 1s, bottom 1s, right 1s, opacity 0.5s;
		}
		.extendedinfo.open {
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			opacity: 1;
			transition: left 1s, top 1s, bottom 1s, right 1s, opacity 0.5s;
		}
		.extendedinfo .close-icon {
			position: absolute;
			right: -2ex;
			top: -2ex;
			width: 4ex;
			height: 4ex;
			background-image: url('close-button.svg');
			background-size: 100%;
			font-size: 150%;
			z-index: 30;
		}
		.extendedinfoimage {
			float: right;
			width: 400px;
			height: 600px;
		}
		.extendedinfotitle {
			color: #733;
			padding: 15px 20px;
			background-color: #111;
			border-radius: 10px;
		}
		.extendedinfo b {
			color: #863;
		}

		.playvideo {
			display: none;
		}
		.playvideo:target {
			opacity: 1;
			z-index: 20;
			top: 3px;
			bottom: 3px;
			left: 3px;
			right: 3px;
			height:96%;
			margin: 0;
			padding: 0ex;
			padding-top: 1ex;
			display: block;
			position: fixed;
			background: #222;
			vertical-align: middle;
			animation: fadein 1s;
			-webkit-animation: fadein 1s;
		}
		.playvideo .close-icon {
			position: fixed;
			right: 0;
			width: 2ex;
			height: 2ex;
			background-image: url('close-button.svg');
			background-size: 100%;
			font-size: 200%;
			z-index: 30;
		}
		.playvideo video {
			display: block;
			margin-right: auto;
			margin-left: auto;
			left: 0;
			right: 0;
			max-height: 100%;
			width: 95%;
		}
		
		/* Search */
		.ui-menu-item .imdbTitle{
			font-size: 0.9em;
			font-weight: bold;
		}
		.ui-menu-item .imdbCast{
			font-size: 0.7em;
			font-style: italic;
			line-height: 110%;
			color: #666;
		}
		.ui-menu-item .imdbImage{
			float: left;
			margin-right: 5px;
		}
		.ui-menu-item .clear{
			clear: both;
		}
		img.poster {
			/*border: 1pt solid red;*/
			background-image: url('logo-guifibaix-mediateca.svg');
			background-color: #222;
			background-position: center center;
			background-repeat: no-repeat;
			background-size: contain;
		}
	</style>
</head>
<body>
	<header>
		<form class='search'>
			<select name='searchkind'>
				<option value='movies'>Películas</option>
				<option value='series'>Series</option>
				<option value='documentary'>Documentales</option>
				<option value='music'>Música</option>
				<option value='books'>Libros</option>
				<option value='comics'>Cómics</option>
				<input name="s" value="all" type="hidden" />
			</select>
			<input name='searchtext' id='searchtext' placeholder='search...'></input>
			<input name="s" value="all" type="hidden" />
			Ordena por:
			<select name='searchorder'>
				<option value='new'>Novedad</option>
				<option value='popular'>Popularidad</option>
				<option value='rated'>Valoración</option>
				<option value='pending'>Las que aún no he visto</option>
				<option value='preferred'>Mis preferidas</option>
			</select>
		</form>
	</header>
	<div class='itembrowser'>
	</div>
	<div  id='playvideo1' class='playvideo'>
		<a class='close-icon' href='#'></a>
		<video preload='none' controls poster='logo-guifibaix-mediateca.png'>
<!--			<source
				src='http://video.webmfiles.org/big-buck-bunny_trailer.webm'
				type='video/webm'
				media="all and (max-width:480px)"
				/>
-->
			<source
				src='http://video.webmfiles.org/big-buck-bunny_trailer.webm'
				type='video/webm'
				/>
		</video>
	</div>
	<div  id='playvideo2' class='playvideo'>
		<a class='close-icon' href='#'></a>
		<video preload='none' controls poster='logo-guifibaix-mediateca.png'>
			<source 
				src='http://video.webmfiles.org/elephants-dream.webm'
				type='video/webm'
				/>
		</video>
	</div>
	<div class="extendedinfo">
		<a class='close-icon' onclick="closeExtendedInfo()"></a>
		<img class="extendedinfoimage poster"></img>
		<h2 class='extendedinfotitle'></h2>
		<ul class='extendedinfodata' />
		<div class='extendedinfoactions'>
		</div>
	</div>
	<footer class='footer'>
		Mediateca GuifiBaix
	</footer>

<script type="text/javascript">

function showExtendedInfo(id)
{
	$(".extendedinfo").addClass("open");
	$.getJSON("http://www.omdbapi.com/?r=JSON&i="+encodeURIComponent(id), function(result){
		var mutedkeys = [
			"Title",
			"Type",
			"Year",
			"imdbID",
		];
		var sortedkeys = [
			"Genre",
			"Plot",
			"Director",
			"Writer",
			"Actors",
		];
		var info = $(".extendedinfodata");
		$.each(sortedkeys, function(index, key) {
			if (!(key in result)) return;
			info.append("<li><b>"+key+":</b> "+result[key]+"</li>");
		});
		$.each(result, function(key, value) {
			if ($.inArray(key, sortedkeys)) return;
			if ($.inArray(key, mutedkeys)) return;
			info.append("<li><b>"+key+":</b> "+value+"</li>");
		});
		$(".extendedinfoimage").attr("src",
			baseproxyurl+"imdbimage.php?url="+encodeURIComponent(result.Poster));
		$(".extendedinfotitle").text(result.Title + " ("+result.Year+") ["+result.Type+"]");
	});
}
function closeExtendedInfo()
{
	$(".extendedinfo").removeClass("open");
	$(".extendedinfodata").empty();
	$(".extendedinfoimage").attr("src","");
}


$(function(){
    $("#searchtext").focus(); //Focus on search field
    $("#searchtext").autocomplete({
        minLength: 0,
        delay:5,
        source: baseproxyurl+"imdbsuggest.php",
        focus: function( event, ui ) {
            $(this).val( ui.item.value );
            return false;
        },
        select: function( event, ui ) {
            $(this).val( ui.item.value );
            return false;
        }
    }).data("ui-autocomplete")._renderItem = function( ul, item ) {
        return $("<li></li>")
            .data( "item.autocomplete", item )
            .append(
				"<a>" +
				(item.img?
					"<img class='imdbImage' src='"+baseproxyurl+"imdbimage.php?url=" +
						encodeURIComponent(item.img) + "' />":"") + 
				"<span class='imdbTitle'>" + item.label + "</span>" +
				(item.cast?"<br /><span class='imdbCast'>" + item.cast + "</span>":"") +
				"<div class='clear'></div>"+
				"</a>" )
            .appendTo( ul );
    };
});

var baseproxyurl="http://canvoki.net/mediateca/";

function clearMediaItems() {
//	console.log("Clearing media items");
	$(".itembrowser").empty();
//	console.log("Clearing media items DONE");
}

function loadMediaItem(id) {
//	console.log("Scheduling load for "+id);
	var item = $('.mediaitem#'+id);
	$.getJSON("http://www.omdbapi.com/?r=JSON&i="+encodeURIComponent(id), function(result){
//		console.log("Loading data for "+id);
		if (result.Poster != "N/A" )
			$(item).find("img").attr("src",
				baseproxyurl+"imdbimage.php?url="+encodeURIComponent(result.Poster));
		$(item).find(".mediadescription").html(result.Title+" ["+ result.Type +"] ("+result.Year+")");
	}).fail(function() {
		alert("Load for "+id+" failed");
	});
//	console.log("Scheduled load for " + id);
}

function addMediaItem(id) {
	console.log("Adding widget for " + id );
	$(".itembrowser").append(
"	<div class='mediaitem' id='"+id+"'>\n"+
"		<img class='poster' src='bad.png'/>\n"+
"		<div class='mediatitle'>\n"+
"		</div>\n"+
"		<div class='mediadescription'>\n"+
"			Loading info...\n"+
"		</div>\n"+
"	</div>\n"+
	"")
	$("#"+id).click(function(event) {
		showExtendedInfo(id);
	});
	loadMediaItem(id);
//	console.log("Added widget for " + id );
}

function proxiedCall(uri, done, settings)
{

	var proxiedUri= baseproxyurl + "proxy.php?callback=?&url=" + encodeURIComponent(uri);
	var verbose = 'verbose' in settings && settings.verbose==true;
	var failed = 'failed' in settings ? settings.failed : console.log;
	function log(whatever) { if (verbose) console.log(whatever); }

	log("Starting: " + proxiedUri);

	$.getJSON(proxiedUri, function(result) {
		log("Success " + proxiedUri);
		log(result);
		if (result.status.http_code == 200)
			done(result.contents);
		else
			failed(result.status);
	}).fail(function(code, text, headers) {
		log("Failed " + proxiedUri);
		log(text);
		log(headers);
		log(code);
	}).always(function(code, text, headers) {
		log("Done " + proxiedUri);
	});
	log("Started: " + proxiedUri);
}


function addSearchResultsMediaItems(query)
{
	proxiedCall("http://www.imdb.com/xml/find?nr=1&tt=on&json=1&q="+encodeURIComponent(query),
		function (searchResult) {
//			console.log("Doing!!");
			$.each((searchResult), function(index, list) {
				$.each(list, function(type, item) {
					addMediaItem(item.id);
				});
			})
		}, {verbose: false});
}

function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
        vars[key] = value;
    });
    return vars;
}

$(function () {
	clearMediaItems();

	var searchtext = getUrlVars().searchtext;
	if (searchtext)
	{
		$("#searchtext").attr("value", searchtext);
		addSearchResultsMediaItems(searchtext);
		return
	}
	var initialItems = [
		'tt0093870',
		'tt0944947',
		'tt0079501',
		'tt1375666',
	];
	$.each(initialItems, function(index, id) {
		addMediaItem(id);
	});
});


</script>
</body>
</html>
